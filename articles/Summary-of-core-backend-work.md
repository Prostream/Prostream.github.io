# 分布式核心工作总结：

## 做了什么：

1. 承接离职同事的试点数据迁移工作
    1. 灰度客户的账户信息+流水信息（进行一点程度的结构变化）迁移到新的数据库，生成迁移报表反馈给业务部门
2. 负责存款组的交易逻辑开发维护：
    1. 新账户开户（生成账号，产品接口，创建合约和产品）
    2. 活期账户转账（根据输入获取账户和合约，汇款接口，账务接口（涉及事务），流水生成和登记，异步消息通知）

## 学到了什么

1. 分布式数据库设计：Sharding键的设置：
    1. 键本身要选择的比较好防止热点的，比如cst_num
    2. 比如hashmap的hash算法，可以避免数据集中堆积 
2. 为什么前端使用 SOAP 报文
    1. 历史遗留系统使用 SOAP 协议，不如 REST 灵活，前后端联调效率低（需要平台层配置了逻辑把soap转换成data bean）
3. 负载均衡、缓存与路由策略
    1. 在平台层做缓存和路由的好处是减轻应用压力
4. 微服务之间的高频调用
    1. 多次调用导致响应时间变长, 合并 RPC 请求
    2. 用缓存减少读操作
5. CRUD 性能 + 分库分表 + 索引
    1. 使用 MyBatis + ShardingJDBC
    2. 应用层 SQL 操作必须带分片键 + 索引字段
6. 失败交易的冲账机制
    1. 每笔交易带 traceId，支持失败交易回溯,事务消息 + 补偿机制（冲账）
    2. “强一致性”在微服务中成本极高，因此冲账机制作为一种业务容错策略更可控。也因此我主动学习了 TCC、Saga 等模式
7. 接口封装 + 插件辅助:
    1. 提议开发 IntelliJ 插件，对 SQL 分片键缺失、命名不规范等做提示；

## 可能的问题：

1. 你怎么快速理解别人的代码和迁移脚本的逻辑？
2. 你和业务方沟通报表时是否遇到过理解偏差，怎么解决的？
3. 你用了哪些工具来执行迁移？Python？Shell？MyBatis？
4. 这个工作你是独立完成的吗？有没有卡住的地方？
5. 这个迁移上线时间是否有 deadline，你如何确保按期交付？